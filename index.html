<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador e Validador de Senhas</title>
    <meta name="author" content="Onivaldo Miquelino">      
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: ui-sans-serif, system-ui; }
        .score-0 { background-color: #fca5a5; } /* Red */
        .score-1 { background-color: #fdba74; } /* Orange */
        .score-2 { background-color: #fcd34d; } /* Yellow */
        .score-3 { background-color: #86efac; } /* Light Green */
        .score-4 { background-color: #4ade80; } /* Green */
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-2xl">
        <h1 class="text-3xl font-bold text-center text-indigo-700 mb-6">Gerador e Validador de Senhas Seguras</h1>
        
        <div class="flex border-b border-gray-200 mb-6">
            <button id="tabGenerate" class="px-4 py-2 text-sm font-medium border-b-2 border-indigo-500 text-indigo-600 transition duration-150 ease-in-out">
                Gerador de Senha
            </button>
            <button id="tabValidate" class="px-4 py-2 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700 transition duration-150 ease-in-out">
                Validador de Força
            </button>
        </div>

        <div id="contentGenerate" class="space-y-6">
            <h2 class="text-xl font-semibold text-gray-800">1. Gerar Nova Senha</h2>
            
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div class="col-span-1">
                    <label for="passLength" class="block text-sm font-medium text-gray-700">Comprimento (8-32)</label>
                    <input type="number" id="passLength" min="8" max="32" value="16" class="mt-1 block w-full rounded-md border-gray-300 p-2 border">
                </div>
                <div class="flex items-end">
                    <input type="checkbox" id="useNumbers" checked class="h-4 w-4 text-indigo-600 border-gray-300 rounded mr-2">
                    <label for="useNumbers" class="text-sm font-medium text-gray-700">Incluir Números</label>
                </div>
                <div class="flex items-end">
                    <input type="checkbox" id="useSpecial" checked class="h-4 w-4 text-indigo-600 border-gray-300 rounded mr-2">
                    <label for="useSpecial" class="text-sm font-medium text-gray-700">Incluir Especiais</label>
                </div>
            </div>
            
            <button id="generateBtn" class="w-full py-3 px-4 rounded-md shadow-lg text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                Gerar Senha
            </button>

            <div class="p-4 bg-gray-50 border border-gray-200 rounded-md">
                <p class="text-sm font-medium text-gray-700 mb-1">Senha Gerada:</p>
                <div class="flex items-center">
                    <input type="text" id="generatedPassword" readonly class="flex-1 font-mono text-lg p-1 bg-transparent border-none focus:ring-0">
                    <button id="copyBtn" class="ml-2 p-1 text-sm text-indigo-600 hover:text-indigo-800 transition">Copiar</button>
                </div>
            </div>
        </div>

        <div id="contentValidate" class="space-y-6 hidden">
            <h2 class="text-xl font-semibold text-gray-800">2. Validar Força da Senha</h2>
            
            <div>
                <label for="passwordInput" class="block text-sm font-medium text-gray-700">Senha a Analisar</label>
                <input type="text" id="passwordInput" class="mt-1 block w-full rounded-md border-gray-300 p-2 border" placeholder="Digite sua senha aqui...">
            </div>

            <div id="validationResult" class="p-4 bg-white border border-gray-200 rounded-md shadow-inner hidden">
                <p class="text-sm font-medium text-gray-700 mb-2">Pontuação de Força:</p>
                <div class="flex items-center space-x-4 mb-4">
                    <span id="scoreBadge" class="px-3 py-1 text-sm font-bold rounded-full text-white">N/A</span>
                    <div class="flex-1 h-3 rounded-full bg-gray-200">
                        <div id="scoreBar" class="h-full rounded-full transition-all duration-500 ease-in-out" style="width: 0%;"></div>
                    </div>
                </div>

                <div class="text-sm">
                    <p class="font-semibold text-gray-700 mb-1">Tempo de Quebra (Throttle):</p>
                    <p id="crackTime" class="font-mono text-gray-600 text-xs">Aguardando análise...</p>
                    
                    <p class="font-semibold text-gray-700 mt-3 mb-1">Dicas de Melhoria:</p>
                    <ul id="suggestionsList" class="list-disc list-inside text-gray-600 ml-4">
                        <li>Digite uma senha para começar a análise.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ******************************************************************************
        // ATENÇÃO: Mude esta URL para o caminho correto do seu arquivo api.php no servidor
        // ******************************************************************************
        const API_URL = 'api.php'; 

        // Elementos do Gerador
        const tabGenerate = document.getElementById('tabGenerate');
        const contentGenerate = document.getElementById('contentGenerate');
        const passLength = document.getElementById('passLength');
        const useNumbers = document.getElementById('useNumbers');
        const useSpecial = document.getElementById('useSpecial');
        const generateBtn = document.getElementById('generateBtn');
        const generatedPassword = document.getElementById('generatedPassword');
        const copyBtn = document.getElementById('copyBtn');
        
        // Elementos do Validador
        const tabValidate = document.getElementById('tabValidate');
        const contentValidate = document.getElementById('contentValidate');
        const passwordInput = document.getElementById('passwordInput');
        const validationResult = document.getElementById('validationResult');
        const scoreBadge = document.getElementById('scoreBadge');
        const scoreBar = document.getElementById('scoreBar');
        const crackTime = document.getElementById('crackTime');
        const suggestionsList = document.getElementById('suggestionsList');

        // --- Funções de Navegação (Tabs) ---
        function switchTab(activeTab) {
            if (activeTab === 'generate') {
                tabGenerate.classList.add('border-indigo-500', 'text-indigo-600');
                tabGenerate.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700');
                tabValidate.classList.remove('border-indigo-500', 'text-indigo-600');
                tabValidate.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700');
                contentGenerate.classList.remove('hidden');
                contentValidate.classList.add('hidden');
            } else {
                tabValidate.classList.add('border-indigo-500', 'text-indigo-600');
                tabValidate.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700');
                tabGenerate.classList.remove('border-indigo-500', 'text-indigo-600');
                tabGenerate.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700');
                contentValidate.classList.remove('hidden');
                contentGenerate.classList.add('hidden');
            }
        }
        tabGenerate.addEventListener('click', () => switchTab('generate'));
        tabValidate.addEventListener('click', () => switchTab('validate'));


        // --- Funções de API ---

        async function apiCall(action, data = {}) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action, ...data })
                });

                const result = await response.json();
                
                if (response.ok && result.success) {
                    return { success: true, data: result.data };
                } else {
                    alert(`Erro na API: ${result.error || 'Erro desconhecido'}`);
                    return { success: false, error: result.error };
                }
            } catch (error) {
                alert(`Falha na comunicação com o backend: ${error.message}`);
                return { success: false, error: error.message };
            }
        }

        // --- Gerador ---
        generateBtn.addEventListener('click', async () => {
            const length = parseInt(passLength.value);
            const useNumbersValue = useNumbers.checked;
            const useSpecialValue = useSpecial.checked;

            if (length < 8 || length > 32) {
                alert('O comprimento da senha deve estar entre 8 e 32.');
                return;
            }

            const result = await apiCall('generate', {
                length,
                use_numbers: useNumbersValue,
                use_special: useSpecialValue
            });

            if (result.success) {
                generatedPassword.value = result.data.password;
            }
        });

        copyBtn.addEventListener('click', () => {
            if (generatedPassword.value) {
                navigator.clipboard.writeText(generatedPassword.value).then(() => {
                    copyBtn.textContent = 'Copiado!';
                    setTimeout(() => copyBtn.textContent = 'Copiar', 1000);
                });
            }
        });


        // --- Validador ---

        const scoreColors = ['bg-red-600', 'bg-orange-500', 'bg-yellow-500', 'bg-lime-500', 'bg-green-600'];
        const scoreLabels = ['Muito Fraca', 'Fraca', 'Razoável', 'Forte', 'Muito Forte'];

        let validationTimeout;
        
        passwordInput.addEventListener('input', () => {
            clearTimeout(validationTimeout);
            const password = passwordInput.value;

            if (password.length === 0) {
                validationResult.classList.add('hidden');
                return;
            }

            // Atraso para evitar spam de requisições ao digitar
            validationTimeout = setTimeout(() => {
                validatePassword(password);
            }, 300);
        });

        async function validatePassword(password) {
            validationResult.classList.remove('hidden');
            scoreBadge.textContent = '...';
            scoreBar.style.width = '0%';
            
            const result = await apiCall('validate', { password });

            if (result.success) {
                const data = result.data;
                const score = data.score; // 0 a 4
                
                // Atualizar Badge e Barra
                scoreColors.forEach(c => scoreBadge.classList.remove(c));
                scoreBadge.classList.add(scoreColors[score]);
                scoreBadge.textContent = scoreLabels[score];
                scoreBar.style.width = ((score + 1) * 20) + '%'; 
                scoreBar.className = `h-full rounded-full transition-all duration-500 ease-in-out ${scoreColors[score]}`;
                
                // Tempo de Quebra
                crackTime.textContent = data.crack_time;

                // Sugestões
                suggestionsList.innerHTML = '';
                if (data.suggestions.length > 0) {
                    data.suggestions.forEach(s => {
                        const li = document.createElement('li');
                        li.textContent = s;
                        suggestionsList.appendChild(li);
                    });
                } else if (data.score === 4) {
                    const li = document.createElement('li');
                    li.textContent = 'Esta senha é muito forte. Excelente!';
                    suggestionsList.appendChild(li);
                } else {
                     const li = document.createElement('li');
                     li.textContent = data.warning || 'Nenhuma sugestão específica, mas a senha ainda pode ser melhorada.';
                     suggestionsList.appendChild(li);
                }
            }
        }
    </script>
</body>
</html>    